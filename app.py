import streamlit as st
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.neighbors import NearestNeighbors

# --- Dataset simplificado para demostraciÃ³n (usa el tuyo completo en producciÃ³n) ---
data = {
  "busqueda": [
    "accesorios para mascotas",
    "bicicletas de montaÃ±a",
    "bicicleta estatica",
    "coches electricos",
    "consolas de nueva generacion",
    "documentales sobre salud",
    "juegos de estrategia",
    "decoracion de interiores",
    "hoteles baratos",
    "accesorios para mascotas",
    "mochilas de senderismo",
    "batidos de proteina",
    "motos deportivas",
    "drone para fotografia",
    "libros de autoayuda",
    "peliculas de accion",
    "herramientas de jardin",
    "power bank para viajes",
    "alimento premium gatos",
    "zapatos de senderismo",
    "suplementos fitness",
    "coches electricos",
    "mouse gamer",
    "recetas veganas",
    "libros de misterio",
    "sillas ergonomicas",
    "hoteles baratos",
    "correas para perros",
    "bicicletas de montaÃ±a",
    "zapatillas deportivas",
    "motos deportivas",
    "smartwatch deportivo",
    "yoga principiantes",
    "peliculas de ciencia ficcion",
    "plantas de interior",
    "cargador solar portÃ¡til",
    "accesorios para mascotas",
    "zapatos de senderismo",
    "ropa de ejercicio",
    "coches electricos",
    "teclado mecanico",
    "aplicaciones de recetas",
    "series de fantasia",
    "escritorios ajustables",
    "viajes a la playa",
    "alimento premium gatos",
    "mochilas de senderismo",
    "calcetines deportivos",
    "motos deportivas",
    "auriculares gamer",
    "meditacion guiada",
    "videojuegos de rol",
    "macetas decorativas",
    "cargador solar portÃ¡til",
    "correas para perros",
    "bicicletas de montaÃ±a",
    "entrenamiento en casa",
    "coches electricos",
    "pantalla 4K",
    "recetas saludables",
    "peliculas romanticas",
    "pantallas LED decorativas",
    "viajes a la playa",
    "alimento premium gatos",
    "zapatos de senderismo",
    "camisetas running",
    "motos deportivas",
    "reloj Garmin",
    "colchoneta yoga",
    "series policiacas",
    "luces inteligentes",
    "hoteles baratos",
    "accesorios para mascotas",
    "mochilas de senderismo",
    "mancuernas ajustables",
    "coches electricos",
    "auriculares inalambricos gym",
    "tupper saludables",
    "peliculas de ciencia ficcion",
    "robots de limpieza",
    "cargador solar portÃ¡til",
    "correas para perros",
    "zapatos de senderismo",
    "ropa termica para correr",
    "motos deportivas",
    "camara deportiva",
    "libros de autoayuda",
    "juegos de estrategia",
    "herramientas de jardin",
    "power bank para viajes",
    "accesorios para mascotas",
    "bicicletas de montaÃ±a",
    "pesas rusas",
    "coches electricos",
    "smartwatch deportivo",
    "documentales sobre salud",
    "series de fantasia",
    "decoracion de interiores",
    "hoteles baratos",
    "alimento premium gatos",
    "mochilas de senderismo",
    "zapatillas deportivas",
    "motos deportivas",
    "consolas de nueva generacion",
    "recetas saludables",
    "peliculas de accion",
    "plantas de interior",
    "viajes a la playa",
    "correas para perros",
    "zapatos de senderismo",
    "ropa de ejercicio",
    "coches electricos",
    "mouse gamer",
    "yoga principiantes",
    "libros de misterio",
    "sillas ergonomicas",
    "hoteles baratos",
    "accesorios para mascotas",
    "bicicletas de montaÃ±a",
    "suplementos fitness",
    "motos deportivas",
    "teclado mecanico",
    "aplicaciones de recetas",
    "videojuegos de rol",
    "escritorios ajustables",
    "cargador solar portÃ¡til",
    "alimento premium gatos",
    "mochilas de senderismo",
    "bicicleta estatica",
    "coches electricos",
    "auriculares gamer",
    "meditacion guiada",
    "peliculas romanticas",
    "macetas decorativas",
    "power bank para viajes",
    "correas para perros",
    "zapatos de senderismo",
    "camisetas running",
    "motos deportivas",
    "reloj Garmin",
    "colchoneta yoga",
    "series policiacas",
    "pantallas LED decorativas",
    "viajes a la playa",
    "accesorios para mascotas",
    "bicicletas de montaÃ±a",
    "entrenamiento en casa",
    "motos deportivas",
    "pantalla 4K",
    "recetas veganas",
    "peliculas de ciencia ficcion",
    "luces inteligentes",
    "hoteles baratos",
    "alimento premium gatos",
    "zapatos de senderismo",
    "batidos de proteina",
    "coches electricos",
    "auriculares inalambricos gym",
    "tupper saludables",
    "juegos de estrategia",
    "robots de limpieza"
  ],
  "tema_interes": [
    "mascotas",
    "deportes al aire libre",
    "fitness",
    "movilidad sostenible",
    "videojuegos",
    "salud",
    "entretenimiento",
    "hogar",
    "viajes",
    "mascotas",
    "accesorios de montaÃ±a",
    "nutriciÃ³n",
    "motociclismo",
    "fotografÃ­a aÃ©rea",
    "crecimiento personal",
    "cine",
    "jardinerÃ­a",
    "tecnologÃ­a portÃ¡til",
    "mascotas",
    "accesorios de montaÃ±a",
    "nutriciÃ³n deportiva",
    "movilidad sostenible",
    "gaming",
    "alimentaciÃ³n saludable",
    "lectura",
    "oficina saludable",
    "viajes",
    "mascotas",
    "deportes al aire libre",
    "ropa deportiva",
    "motociclismo",
    "wearables",
    "bienestar",
    "cine",
    "decoraciÃ³n",
    "energÃ­a renovable",
    "mascotas",
    "accesorios de montaÃ±a",
    "ropa deportiva",
    "movilidad sostenible",
    "tecnologÃ­a",
    "alimentaciÃ³n saludable",
    "entretenimiento",
    "ergonomÃ­a",
    "turismo",
    "mascotas",
    "accesorios de montaÃ±a",
    "ropa deportiva",
    "motociclismo",
    "gaming",
    "bienestar",
    "videojuegos",
    "hogar",
    "energÃ­a renovable",
    "mascotas",
    "deportes al aire libre",
    "otro",
    "movilidad sostenible",
    "cine",
    "salud",
    "cine",
    "hogar inteligente",
    "turismo",
    "mascotas",
    "accesorios de montaÃ±a",
    "otro",
    "motociclismo",
    "wearables",
    "bienestar",
    "entretenimiento",
    "hogar inteligente",
    "viajes",
    "mascotas",
    "accesorios de montaÃ±a",
    "fitness",
    "movilidad sostenible",
    "tecnologÃ­a deportiva",
    "salud",
    "cine",
    "hogar inteligente",
    "energÃ­a renovable",
    "mascotas",
    "accesorios de montaÃ±a",
    "ropa deportiva",
    "motociclismo",
    "cÃ¡mara de acciÃ³n",
    "crecimiento personal",
    "entretenimiento",
    "jardinerÃ­a",
    "tecnologÃ­a portÃ¡til",
    "mascotas",
    "deportes al aire libre",
    "fitness",
    "movilidad sostenible",
    "wearables",
    "salud",
    "entretenimiento",
    "hogar",
    "viajes",
    "mascotas",
    "accesorios de montaÃ±a",
    "ropa deportiva",
    "motociclismo",
    "videojuegos",
    "salud",
    "cine",
    "decoraciÃ³n",
    "turismo",
    "mascotas",
    "accesorios de montaÃ±a",
    "ropa deportiva",
    "movilidad sostenible",
    "gaming",
    "bienestar",
    "lectura",
    "oficina saludable",
    "viajes",
    "mascotas",
    "deportes al aire libre",
    "nutriciÃ³n deportiva",
    "motociclismo",
    "tecnologÃ­a",
    "alimentaciÃ³n saludable",
    "videojuegos",
    "ergonomÃ­a",
    "energÃ­a renovable",
    "mascotas",
    "accesorios de montaÃ±a",
    "fitness",
    "movilidad sostenible",
    "gaming",
    "bienestar",
    "cine",
    "hogar",
    "tecnologÃ­a portÃ¡til",
    "mascotas",
    "accesorios de montaÃ±a",
    "otro",
    "motociclismo",
    "wearables",
    "bienestar",
    "entretenimiento",
    "hogar inteligente",
    "turismo",
    "mascotas",
    "deportes al aire libre",
    "otro",
    "motociclismo",
    "cine",
    "alimentaciÃ³n saludable",
    "cine",
    "hogar inteligente",
    "viajes",
    "mascotas",
    "accesorios de montaÃ±a",
    "nutriciÃ³n",
    "movilidad sostenible",
    "tecnologÃ­a deportiva",
    "salud",
    "entretenimiento",
    "hogar inteligente"
  ],
  "anuncio_sugerido": [
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Bicicleta EstÃ¡tica Schwinn IC4 con Bluetooth",
    "Tesla Model 3 Long Range AWD 2024",
    "PlayStation 5 EdiciÃ³n Digital",
    "ColecciÃ³n de documentales 'Heal' en Blu-ray",
    "Juego de mesa Catan EdiciÃ³n 25 Aniversario",
    "Set de cuadros minimalistas Nordic para sala",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Mochila The North Face Terra 55L",
    "ProteÃ­na Gold Standard 100% Whey 2.27 kg",
    "Yamaha YZF-R3 ABS 2024",
    "DJI Mini 3 Pro con control remoto RC",
    "Libro 'Los 7 hÃ¡bitos de la gente altamente efectiva'",
    "ColecciÃ³n Blu-ray John Wick TrilogÃ­a",
    "Kit Black+Decker de jardinerÃ­a 5 piezas",
    "Anker PowerCore 26800mAh con carga rÃ¡pida",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Creatina Micronizada Optimum Nutrition 300g",
    "Tesla Model 3 Long Range AWD 2024",
    "Logitech G502 HERO RGB 25K",
    "Libro 'Veganomicon' â€“ Cocina vegana gourmet",
    "Libro 'La chica del tren' de Paula Hawkins",
    "Silla ergonÃ³mica SIHOO M18 con soporte lumbar",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "Correa retrÃ¡ctil Flexi Giant 8m",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Nike Air Zoom Pegasus 40",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Forerunner 255 Music",
    "Kit de Yoga Gaiam Essentials con mat y bloques",
    "ColecciÃ³n Blu-ray Star Wars Saga",
    "Planta Sansevieria en maceta decorativa",
    "Panel solar portÃ¡til BigBlue 28W USB",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Leggings deportivos Gymshark Adapt",
    "Tesla Model 3 Long Range AWD 2024",
    "Teclado mecÃ¡nico Razer BlackWidow V4",
    "SuscripciÃ³n anual a FitMenCook App",
    "Boxset Blu-ray Game of Thrones Completa",
    "Escritorio elÃ©ctrico FLEXISPOT EG1",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Calcetines Nike Everyday Cushion 3 pares",
    "Yamaha YZF-R3 ABS 2024",
    "Auriculares HyperX Cloud II Wireless",
    "SuscripciÃ³n anual a la app Calm Premium",
    "The Legend of Zelda: Tears of the Kingdom",
    "Set de 3 macetas cerÃ¡micas estilo nÃ³rdico",
    "Panel solar portÃ¡til BigBlue 28W USB",
    "Correa retrÃ¡ctil Flexi Giant 8m",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Producto destacado relacionado con: entrenamiento en casa",
    "Tesla Model 3 Long Range AWD 2024",
    "Samsung Smart TV 55â€ 4K UHD Crystal",
    "Libro 'Cocina sana para disfrutar' â€“ Isasaweis",
    "ColecciÃ³n Blu-ray 'Antes del amanecer' trilogÃ­a",
    "Tira LED Govee RGBIC con control app",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Producto destacado relacionado con: camisetas running",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Fenix 7 Solar",
    "Colchoneta Manduka PRO Yoga Mat 6mm",
    "Boxset Blu-ray Sherlock BBC completa",
    "Philips Hue White & Color Ambiance Kit",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Mochila The North Face Terra 55L",
    "Mancuernas ajustables Bowflex SelectTech 552",
    "Tesla Model 3 Long Range AWD 2024",
    "Jabra Elite 7 Active True Wireless",
    "Set de Tuppers Rubbermaid Brilliance BPA-Free",
    "ColecciÃ³n Blu-ray Star Wars Saga",
    "iRobot Roomba j7+ con estaciÃ³n de vaciado",
    "Panel solar portÃ¡til BigBlue 28W USB",
    "Correa retrÃ¡ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Camiseta tÃ©rmica Under Armour ColdGear",
    "Yamaha YZF-R3 ABS 2024",
    "GoPro Hero 12 Black",
    "Libro 'Los 7 hÃ¡bitos de la gente altamente efectiva'",
    "Juego de mesa Catan EdiciÃ³n 25 Aniversario",
    "Kit Black+Decker de jardinerÃ­a 5 piezas",
    "Anker PowerCore 26800mAh con carga rÃ¡pida",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Pesa rusa Kettlebell Amazon Basics 12kg",
    "Tesla Model 3 Long Range AWD 2024",
    "Garmin Forerunner 255 Music",
    "ColecciÃ³n de documentales 'Heal' en Blu-ray",
    "Boxset Blu-ray Game of Thrones Completa",
    "Set de cuadros minimalistas Nordic para sala",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Nike Air Zoom Pegasus 40",
    "Yamaha YZF-R3 ABS 2024",
    "PlayStation 5 EdiciÃ³n Digital",
    "Libro 'Cocina sana para disfrutar' â€“ Isasaweis",
    "ColecciÃ³n Blu-ray John Wick TrilogÃ­a",
    "Planta Sansevieria en maceta decorativa",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Correa retrÃ¡ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Leggings deportivos Gymshark Adapt",
    "Tesla Model 3 Long Range AWD 2024",
    "Logitech G502 HERO RGB 25K",
    "Kit de Yoga Gaiam Essentials con mat y bloques",
    "Libro 'La chica del tren' de Paula Hawkins",
    "Silla ergonÃ³mica SIHOO M18 con soporte lumbar",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Creatina Micronizada Optimum Nutrition 300g",
    "Yamaha YZF-R3 ABS 2024",
    "Teclado mecÃ¡nico Razer BlackWidow V4",
    "SuscripciÃ³n anual a FitMenCook App",
    "The Legend of Zelda: Tears of the Kingdom",
    "Escritorio elÃ©ctrico FLEXISPOT EG1",
    "Panel solar portÃ¡til BigBlue 28W USB",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Bicicleta EstÃ¡tica Schwinn IC4 con Bluetooth",
    "Tesla Model 3 Long Range AWD 2024",
    "Auriculares HyperX Cloud II Wireless",
    "SuscripciÃ³n anual a la app Calm Premium",
    "ColecciÃ³n Blu-ray 'Antes del amanecer' trilogÃ­a",
    "Set de 3 macetas cerÃ¡micas estilo nÃ³rdico",
    "Anker PowerCore 26800mAh con carga rÃ¡pida",
    "Correa retrÃ¡ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Producto destacado relacionado con: camisetas running",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Fenix 7 Solar",
    "Colchoneta Manduka PRO Yoga Mat 6mm",
    "Boxset Blu-ray Sherlock BBC completa",
    "Tira LED Govee RGBIC con control app",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "ArnÃ©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensiÃ³n delantera",
    "Producto destacado relacionado con: entrenamiento en casa",
    "Yamaha YZF-R3 ABS 2024",
    "Samsung Smart TV 55â€ 4K UHD Crystal",
    "Libro 'Veganomicon' â€“ Cocina vegana gourmet",
    "ColecciÃ³n Blu-ray Star Wars Saga",
    "Philips Hue White & Color Ambiance Kit",
    "SuscripciÃ³n Booking.com Genius Level 3",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "ProteÃ­na Gold Standard 100% Whey 2.27 kg",
    "Tesla Model 3 Long Range AWD 2024",
    "Jabra Elite 7 Active True Wireless",
    "Set de Tuppers Rubbermaid Brilliance BPA-Free",
    "Juego de mesa Catan EdiciÃ³n 25 Aniversario",
    "iRobot Roomba j7+ con estaciÃ³n de vaciado"
  ]
}

df_busquedas = pd.DataFrame(data)

# --- FunciÃ³n para sugerir anuncios con mejoras ---
def sugerir_anuncios(busqueda_usuario):
    busqueda_usuario_lower = busqueda_usuario.lower()
    temas_relacionados = df_busquedas[df_busquedas["busqueda"].str.contains(busqueda_usuario_lower, case=False)]["tema_interes"].unique()
    sugerencias = []

    if len(temas_relacionados) > 0:
        for tema in temas_relacionados:
            anuncios_posibles = df_busquedas[df_busquedas["tema_interes"] == tema]["anuncio_sugerido"].tolist()
            sugerencias.extend(anuncios_posibles)
        sugerencias_ordenadas = [item for item, _ in Counter(sugerencias).most_common(5)]
        return temas_relacionados, sugerencias_ordenadas
    else:
        temas_populares = df_busquedas["tema_interes"].value_counts().head(3).index.tolist()
        for tema in temas_populares:
            sugerencias.extend(df_busquedas[df_busquedas["tema_interes"] == tema]["anuncio_sugerido"].tolist())
        sugerencias = list(set(sugerencias))[:5]
        return ["popular"], sugerencias

# --- Interfaz Streamlit ---
st.set_page_config(page_title="Sugeridor de Anuncios Inteligente", layout="centered")
st.title("ğŸ” EmulaciÃ³n de Sugerencia de Anuncios por BÃºsqueda")

st.markdown("""
Este sistema simula cÃ³mo una plataforma podrÃ­a sugerir anuncios basados en tus bÃºsquedas.
""")

user_input = st.text_input("Â¿QuÃ© estÃ¡s buscando hoy?", placeholder="Ej: accesorios para mascotas, bicicletas de montaÃ±a")

if user_input:
    temas, sugerencias = sugerir_anuncios(user_input)
    st.markdown(f"ğŸ¯ Tema(s) detectado(s): `{', '.join(temas)}`")

    st.subheader("Anuncios Sugeridos para ti:")
    for anuncio in sugerencias:
        st.info(f"ğŸ‘‰ {anuncio}")
else:
    st.info("Ingresa una bÃºsqueda para ver sugerencias de anuncios.")

st.markdown("---")
st.subheader("ğŸ“„ Dataset utilizado:")
st.dataframe(df_busquedas)
