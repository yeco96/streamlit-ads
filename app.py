import streamlit as st
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.neighbors import NearestNeighbors

# --- Dataset simplificado para demostraci√≥n (usa el tuyo completo en producci√≥n) ---
data = {
  "busqueda": [
    "accesorios para mascotas",
    "bicicletas de monta√±a",
    "bicicleta estatica",
    "coches electricos",
    "consolas de nueva generacion",
    "documentales sobre salud",
    "juegos de estrategia",
    "decoracion de interiores",
    "hoteles baratos",
    "accesorios para mascotas",
    "mochilas de senderismo",
    "batidos de proteina",
    "motos deportivas",
    "drone para fotografia",
    "libros de autoayuda",
    "peliculas de accion",
    "herramientas de jardin",
    "power bank para viajes",
    "alimento premium gatos",
    "zapatos de senderismo",
    "suplementos fitness",
    "coches electricos",
    "mouse gamer",
    "recetas veganas",
    "libros de misterio",
    "sillas ergonomicas",
    "hoteles baratos",
    "correas para perros",
    "bicicletas de monta√±a",
    "zapatillas deportivas",
    "motos deportivas",
    "smartwatch deportivo",
    "yoga principiantes",
    "peliculas de ciencia ficcion",
    "plantas de interior",
    "cargador solar port√°til",
    "accesorios para mascotas",
    "zapatos de senderismo",
    "ropa de ejercicio",
    "coches electricos",
    "teclado mecanico",
    "aplicaciones de recetas",
    "series de fantasia",
    "escritorios ajustables",
    "viajes a la playa",
    "alimento premium gatos",
    "mochilas de senderismo",
    "calcetines deportivos",
    "motos deportivas",
    "auriculares gamer",
    "meditacion guiada",
    "videojuegos de rol",
    "macetas decorativas",
    "cargador solar port√°til",
    "correas para perros",
    "bicicletas de monta√±a",
    "entrenamiento en casa",
    "coches electricos",
    "pantalla 4K",
    "recetas saludables",
    "peliculas romanticas",
    "pantallas LED decorativas",
    "viajes a la playa",
    "alimento premium gatos",
    "zapatos de senderismo",
    "camisetas running",
    "motos deportivas",
    "reloj Garmin",
    "colchoneta yoga",
    "series policiacas",
    "luces inteligentes",
    "hoteles baratos",
    "accesorios para mascotas",
    "mochilas de senderismo",
    "mancuernas ajustables",
    "coches electricos",
    "auriculares inalambricos gym",
    "tupper saludables",
    "peliculas de ciencia ficcion",
    "robots de limpieza",
    "cargador solar port√°til",
    "correas para perros",
    "zapatos de senderismo",
    "ropa termica para correr",
    "motos deportivas",
    "camara deportiva",
    "libros de autoayuda",
    "juegos de estrategia",
    "herramientas de jardin",
    "power bank para viajes",
    "accesorios para mascotas",
    "bicicletas de monta√±a",
    "pesas rusas",
    "coches electricos",
    "smartwatch deportivo",
    "documentales sobre salud",
    "series de fantasia",
    "decoracion de interiores",
    "hoteles baratos",
    "alimento premium gatos",
    "mochilas de senderismo",
    "zapatillas deportivas",
    "motos deportivas",
    "consolas de nueva generacion",
    "recetas saludables",
    "peliculas de accion",
    "plantas de interior",
    "viajes a la playa",
    "correas para perros",
    "zapatos de senderismo",
    "ropa de ejercicio",
    "coches electricos",
    "mouse gamer",
    "yoga principiantes",
    "libros de misterio",
    "sillas ergonomicas",
    "hoteles baratos",
    "accesorios para mascotas",
    "bicicletas de monta√±a",
    "suplementos fitness",
    "motos deportivas",
    "teclado mecanico",
    "aplicaciones de recetas",
    "videojuegos de rol",
    "escritorios ajustables",
    "cargador solar port√°til",
    "alimento premium gatos",
    "mochilas de senderismo",
    "bicicleta estatica",
    "coches electricos",
    "auriculares gamer",
    "meditacion guiada",
    "peliculas romanticas",
    "macetas decorativas",
    "power bank para viajes",
    "correas para perros",
    "zapatos de senderismo",
    "camisetas running",
    "motos deportivas",
    "reloj Garmin",
    "colchoneta yoga",
    "series policiacas",
    "pantallas LED decorativas",
    "viajes a la playa",
    "accesorios para mascotas",
    "bicicletas de monta√±a",
    "entrenamiento en casa",
    "motos deportivas",
    "pantalla 4K",
    "recetas veganas",
    "peliculas de ciencia ficcion",
    "luces inteligentes",
    "hoteles baratos",
    "alimento premium gatos",
    "zapatos de senderismo",
    "batidos de proteina",
    "coches electricos",
    "auriculares inalambricos gym",
    "tupper saludables",
    "juegos de estrategia",
    "robots de limpieza"
  ],
  "tema_interes": [
    "mascotas",
    "deportes al aire libre",
    "fitness",
    "movilidad sostenible",
    "videojuegos",
    "salud",
    "entretenimiento",
    "hogar",
    "viajes",
    "mascotas",
    "accesorios de monta√±a",
    "nutrici√≥n",
    "motociclismo",
    "fotograf√≠a a√©rea",
    "crecimiento personal",
    "cine",
    "jardiner√≠a",
    "tecnolog√≠a port√°til",
    "mascotas",
    "accesorios de monta√±a",
    "nutrici√≥n deportiva",
    "movilidad sostenible",
    "gaming",
    "alimentaci√≥n saludable",
    "lectura",
    "oficina saludable",
    "viajes",
    "mascotas",
    "deportes al aire libre",
    "ropa deportiva",
    "motociclismo",
    "wearables",
    "bienestar",
    "cine",
    "decoraci√≥n",
    "energ√≠a renovable",
    "mascotas",
    "accesorios de monta√±a",
    "ropa deportiva",
    "movilidad sostenible",
    "tecnolog√≠a",
    "alimentaci√≥n saludable",
    "entretenimiento",
    "ergonom√≠a",
    "turismo",
    "mascotas",
    "accesorios de monta√±a",
    "ropa deportiva",
    "motociclismo",
    "gaming",
    "bienestar",
    "videojuegos",
    "hogar",
    "energ√≠a renovable",
    "mascotas",
    "deportes al aire libre",
    "otro",
    "movilidad sostenible",
    "cine",
    "salud",
    "cine",
    "hogar inteligente",
    "turismo",
    "mascotas",
    "accesorios de monta√±a",
    "otro",
    "motociclismo",
    "wearables",
    "bienestar",
    "entretenimiento",
    "hogar inteligente",
    "viajes",
    "mascotas",
    "accesorios de monta√±a",
    "fitness",
    "movilidad sostenible",
    "tecnolog√≠a deportiva",
    "salud",
    "cine",
    "hogar inteligente",
    "energ√≠a renovable",
    "mascotas",
    "accesorios de monta√±a",
    "ropa deportiva",
    "motociclismo",
    "c√°mara de acci√≥n",
    "crecimiento personal",
    "entretenimiento",
    "jardiner√≠a",
    "tecnolog√≠a port√°til",
    "mascotas",
    "deportes al aire libre",
    "fitness",
    "movilidad sostenible",
    "wearables",
    "salud",
    "entretenimiento",
    "hogar",
    "viajes",
    "mascotas",
    "accesorios de monta√±a",
    "ropa deportiva",
    "motociclismo",
    "videojuegos",
    "salud",
    "cine",
    "decoraci√≥n",
    "turismo",
    "mascotas",
    "accesorios de monta√±a",
    "ropa deportiva",
    "movilidad sostenible",
    "gaming",
    "bienestar",
    "lectura",
    "oficina saludable",
    "viajes",
    "mascotas",
    "deportes al aire libre",
    "nutrici√≥n deportiva",
    "motociclismo",
    "tecnolog√≠a",
    "alimentaci√≥n saludable",
    "videojuegos",
    "ergonom√≠a",
    "energ√≠a renovable",
    "mascotas",
    "accesorios de monta√±a",
    "fitness",
    "movilidad sostenible",
    "gaming",
    "bienestar",
    "cine",
    "hogar",
    "tecnolog√≠a port√°til",
    "mascotas",
    "accesorios de monta√±a",
    "otro",
    "motociclismo",
    "wearables",
    "bienestar",
    "entretenimiento",
    "hogar inteligente",
    "turismo",
    "mascotas",
    "deportes al aire libre",
    "otro",
    "motociclismo",
    "cine",
    "alimentaci√≥n saludable",
    "cine",
    "hogar inteligente",
    "viajes",
    "mascotas",
    "accesorios de monta√±a",
    "nutrici√≥n",
    "movilidad sostenible",
    "tecnolog√≠a deportiva",
    "salud",
    "entretenimiento",
    "hogar inteligente"
  ],
  "anuncio_sugerido": [
    "Arn√©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Bicicleta Est√°tica Schwinn IC4 con Bluetooth",
    "Tesla Model 3 Long Range AWD 2024",
    "PlayStation 5 Edici√≥n Digital",
    "Colecci√≥n de documentales 'Heal' en Blu-ray",
    "Juego de mesa Catan Edici√≥n 25 Aniversario",
    "Set de cuadros minimalistas Nordic para sala",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Mochila The North Face Terra 55L",
    "Prote√≠na Gold Standard 100% Whey 2.27 kg",
    "Yamaha YZF-R3 ABS 2024",
    "DJI Mini 3 Pro con control remoto RC",
    "Libro 'Los 7 h√°bitos de la gente altamente efectiva'",
    "Colecci√≥n Blu-ray John Wick Trilog√≠a",
    "Kit Black+Decker de jardiner√≠a 5 piezas",
    "Anker PowerCore 26800mAh con carga r√°pida",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Creatina Micronizada Optimum Nutrition 300g",
    "Tesla Model 3 Long Range AWD 2024",
    "Logitech G502 HERO RGB 25K",
    "Libro 'Veganomicon' ‚Äì Cocina vegana gourmet",
    "Libro 'La chica del tren' de Paula Hawkins",
    "Silla ergon√≥mica SIHOO M18 con soporte lumbar",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Correa retr√°ctil Flexi Giant 8m",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Nike Air Zoom Pegasus 40",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Forerunner 255 Music",
    "Kit de Yoga Gaiam Essentials con mat y bloques",
    "Colecci√≥n Blu-ray Star Wars Saga",
    "Planta Sansevieria en maceta decorativa",
    "Panel solar port√°til BigBlue 28W USB",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Leggings deportivos Gymshark Adapt",
    "Tesla Model 3 Long Range AWD 2024",
    "Teclado mec√°nico Razer BlackWidow V4",
    "Suscripci√≥n anual a FitMenCook App",
    "Boxset Blu-ray Game of Thrones Completa",
    "Escritorio el√©ctrico FLEXISPOT EG1",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Calcetines Nike Everyday Cushion 3 pares",
    "Yamaha YZF-R3 ABS 2024",
    "Auriculares HyperX Cloud II Wireless",
    "Suscripci√≥n anual a la app Calm Premium",
    "The Legend of Zelda: Tears of the Kingdom",
    "Set de 3 macetas cer√°micas estilo n√≥rdico",
    "Panel solar port√°til BigBlue 28W USB",
    "Correa retr√°ctil Flexi Giant 8m",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Producto destacado relacionado con: entrenamiento en casa",
    "Tesla Model 3 Long Range AWD 2024",
    "Samsung Smart TV 55‚Äù 4K UHD Crystal",
    "Libro 'Cocina sana para disfrutar' ‚Äì Isasaweis",
    "Colecci√≥n Blu-ray 'Antes del amanecer' trilog√≠a",
    "Tira LED Govee RGBIC con control app",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Producto destacado relacionado con: camisetas running",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Fenix 7 Solar",
    "Colchoneta Manduka PRO Yoga Mat 6mm",
    "Boxset Blu-ray Sherlock BBC completa",
    "Philips Hue White & Color Ambiance Kit",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Mochila The North Face Terra 55L",
    "Mancuernas ajustables Bowflex SelectTech 552",
    "Tesla Model 3 Long Range AWD 2024",
    "Jabra Elite 7 Active True Wireless",
    "Set de Tuppers Rubbermaid Brilliance BPA-Free",
    "Colecci√≥n Blu-ray Star Wars Saga",
    "iRobot Roomba j7+ con estaci√≥n de vaciado",
    "Panel solar port√°til BigBlue 28W USB",
    "Correa retr√°ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Camiseta t√©rmica Under Armour ColdGear",
    "Yamaha YZF-R3 ABS 2024",
    "GoPro Hero 12 Black",
    "Libro 'Los 7 h√°bitos de la gente altamente efectiva'",
    "Juego de mesa Catan Edici√≥n 25 Aniversario",
    "Kit Black+Decker de jardiner√≠a 5 piezas",
    "Anker PowerCore 26800mAh con carga r√°pida",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Pesa rusa Kettlebell Amazon Basics 12kg",
    "Tesla Model 3 Long Range AWD 2024",
    "Garmin Forerunner 255 Music",
    "Colecci√≥n de documentales 'Heal' en Blu-ray",
    "Boxset Blu-ray Game of Thrones Completa",
    "Set de cuadros minimalistas Nordic para sala",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Nike Air Zoom Pegasus 40",
    "Yamaha YZF-R3 ABS 2024",
    "PlayStation 5 Edici√≥n Digital",
    "Libro 'Cocina sana para disfrutar' ‚Äì Isasaweis",
    "Colecci√≥n Blu-ray John Wick Trilog√≠a",
    "Planta Sansevieria en maceta decorativa",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Correa retr√°ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Leggings deportivos Gymshark Adapt",
    "Tesla Model 3 Long Range AWD 2024",
    "Logitech G502 HERO RGB 25K",
    "Kit de Yoga Gaiam Essentials con mat y bloques",
    "Libro 'La chica del tren' de Paula Hawkins",
    "Silla ergon√≥mica SIHOO M18 con soporte lumbar",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Creatina Micronizada Optimum Nutrition 300g",
    "Yamaha YZF-R3 ABS 2024",
    "Teclado mec√°nico Razer BlackWidow V4",
    "Suscripci√≥n anual a FitMenCook App",
    "The Legend of Zelda: Tears of the Kingdom",
    "Escritorio el√©ctrico FLEXISPOT EG1",
    "Panel solar port√°til BigBlue 28W USB",
    "Royal Canin Feline Health Nutrition Indoor",
    "Mochila The North Face Terra 55L",
    "Bicicleta Est√°tica Schwinn IC4 con Bluetooth",
    "Tesla Model 3 Long Range AWD 2024",
    "Auriculares HyperX Cloud II Wireless",
    "Suscripci√≥n anual a la app Calm Premium",
    "Colecci√≥n Blu-ray 'Antes del amanecer' trilog√≠a",
    "Set de 3 macetas cer√°micas estilo n√≥rdico",
    "Anker PowerCore 26800mAh con carga r√°pida",
    "Correa retr√°ctil Flexi Giant 8m",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Producto destacado relacionado con: camisetas running",
    "Yamaha YZF-R3 ABS 2024",
    "Garmin Fenix 7 Solar",
    "Colchoneta Manduka PRO Yoga Mat 6mm",
    "Boxset Blu-ray Sherlock BBC completa",
    "Tira LED Govee RGBIC con control app",
    "Sombrilla Tommy Bahama con anclaje de arena",
    "Arn√©s Julius-K9 IDC Power para perros",
    "Bicicleta Trek Marlin 7 con suspensi√≥n delantera",
    "Producto destacado relacionado con: entrenamiento en casa",
    "Yamaha YZF-R3 ABS 2024",
    "Samsung Smart TV 55‚Äù 4K UHD Crystal",
    "Libro 'Veganomicon' ‚Äì Cocina vegana gourmet",
    "Colecci√≥n Blu-ray Star Wars Saga",
    "Philips Hue White & Color Ambiance Kit",
    "Suscripci√≥n Booking.com Genius Level 3",
    "Royal Canin Feline Health Nutrition Indoor",
    "Botas Merrell Moab 3 Mid Waterproof",
    "Prote√≠na Gold Standard 100% Whey 2.27 kg",
    "Tesla Model 3 Long Range AWD 2024",
    "Jabra Elite 7 Active True Wireless",
    "Set de Tuppers Rubbermaid Brilliance BPA-Free",
    "Juego de mesa Catan Edici√≥n 25 Aniversario",
    "iRobot Roomba j7+ con estaci√≥n de vaciado"
  ]
}

df_busquedas = pd.DataFrame(data)

# --- Modelo TF-IDF + KNN ---
tfidf = TfidfVectorizer()
X = tfidf.fit_transform(df_busquedas["busqueda"])
knn_model = NearestNeighbors(n_neighbors=3, metric="cosine")
knn_model.fit(X)

# --- Funci√≥n con umbral de similitud ---
def sugerir_anuncios_tfidf(user_input, umbral=0.6):
    vec = tfidf.transform([user_input])
    distancias, indices = knn_model.kneighbors(vec)

    st.write("üîç B√∫squedas similares encontradas:", df_busquedas.iloc[indices[0]]["busqueda"].tolist())
    st.write("üìâ Distancias (cuanto m√°s bajo, mejor):", distancias[0].tolist())

    # Filtrar resultados por similitud (distancia < umbral)
    sugerencias = []
    for i, dist in enumerate(distancias[0]):
        if dist < umbral:
            anuncio = df_busquedas.iloc[indices[0][i]]["anuncio_sugerido"]
            sugerencias.append(anuncio)

    if not sugerencias:
        sugerencias = ["‚ö†Ô∏è No hay coincidencias suficientemente similares."]

    return list(set(sugerencias))

# --- Funci√≥n por tema de inter√©s ---
def sugerir_anuncios_por_tema(busqueda_usuario):
    busqueda_usuario_lower = busqueda_usuario.lower()
    temas_relacionados = df_busquedas[df_busquedas["busqueda"].str.contains(busqueda_usuario_lower, case=False)]["tema_interes"].unique()
    sugerencias = []

    if len(temas_relacionados) > 0:
        for tema in temas_relacionados:
            anuncios_posibles = df_busquedas[df_busquedas["tema_interes"] == tema]["anuncio_sugerido"].tolist()
            sugerencias.extend(anuncios_posibles)
    else:
        sugerencias = ["Anuncios generales: descubre nuevas ofertas."]
    return list(set(sugerencias))[:5]

# --- UI con Streamlit ---
st.set_page_config(page_title="üîç Sugeridor de Anuncios", layout="centered")

st.title("üß† Sugeridor de Anuncios con IA")
st.markdown("Ingresa una b√∫squeda para recibir sugerencias relevantes:")

user_input = st.text_input("¬øQu√© est√°s buscando?", placeholder="Ej: smartwatch para correr, drones con c√°mara")

if user_input:
    st.subheader("üìå Basado en Tema de Inter√©s:")
    sugerencias_tema = sugerir_anuncios_por_tema(user_input)
    for sug in sugerencias_tema:
        st.info(f"üìé {sug}")

    st.subheader("ü§ñ Basado en Similitud (TF-IDF + KNN):")
    sugerencias_tfidf = sugerir_anuncios_tfidf(user_input)
    for sug in sugerencias_tfidf:
        st.success(f"üëâ {sug}")

st.markdown("---")
st.subheader("üóÉÔ∏è Dataset utilizado")
st.dataframe(df_busquedas)

st.caption("Este demo usa TF-IDF y KNN para encontrar anuncios similares. El umbral filtra similitudes d√©biles para evitar resultados gen√©ricos.")
